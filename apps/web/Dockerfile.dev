FROM node:22-alpine

RUN corepack enable
ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"

WORKDIR /app

# Copy workspace configuration and lockfile
COPY pnpm-lock.yaml pnpm-workspace.yaml package.json ./

# Copy package.json files for the service and its local dependencies
COPY apps/web/package.json ./apps/web/
COPY packages/shared/package.json ./packages/shared/

# Install dependencies
RUN --mount=type=cache,target=/pnpm/store \
    pnpm install

# We don't COPY the source code here because we will mount it as a volume
# in docker-compose. However, we need the initial structure for pnpm to work.

EXPOSE 5173

CMD ["pnpm", "--filter", "web", "dev"]
